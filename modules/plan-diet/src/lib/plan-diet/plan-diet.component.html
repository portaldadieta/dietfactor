<div class="container">
  <main class="diet-container">
    <form [formGroup]="dietPlanForm" class="form-container">
      <h1 class="title">Planejar dieta</h1>

      <div class="form-field-container">
        <mat-form-field appearance="fill">
          <mat-label>Objetivo</mat-label>
          <mat-select formControlName="dietGoal">
            <mat-option value="manutencao">Manutenção</mat-option>
            <mat-option value="deficit">Déficit</mat-option>
            <mat-option value="superavit">Superávit</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="fill">
          <mat-label>Déficit/Superávit</mat-label>
          <input
            formControlName="intensity"
            matInput
            placeholder="Déficit/Superávit"
          />
          @if(intensity?.invalid) {
          <mat-error>Por favor, insira um número válido.</mat-error>
          }
        </mat-form-field>

        <div class="form-row">
          <mat-form-field class="small-dropdown">
            <mat-label>Fator de Atividade</mat-label>
            <mat-select appearance="fill" formControlName="activityFactor">
              <mat-option value="leve">Leve</mat-option>
              <mat-option value="moderada">Moderada</mat-option>
              <mat-option value="intensa">Intensa</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </div>

      <div class="search-wrap">
        <mat-form-field appearance="fill" class="food-search">
          <mat-label class="mat-label-wrap">
            <mat-icon>search</mat-icon>
            Pesquisar alimento
          </mat-label>
          <input
            type="search"
            id="search-food"
            placeholder="Ex. Iogurte grego"
            formControlName="foodName"
            matInput
          />
        </mat-form-field>

        <div class="foods-to-select-container">
          <mat-chip-set
            cdkDropList
            #avaiableFoods="cdkDropList"
            [cdkDropListConnectedTo]="[
              dinnerFoodSelected,
              snackFoodSelected,
              lunchFoodSelected,
              breakfastFoodSelected
            ]"
            [cdkDropListData]="filteredFoods"
            cdkDropListOrientation="horizontal"
            (cdkDropListDropped)="dropFood($event)"
            id="possibleFoods"
          >
            @for (food of filteredFoods; track food) {
            <mat-chip cdkDrag>{{ food.name }}</mat-chip>
            } @empty {
            <div class="food-not-found">
              <p class="not-found-message">
                Não foram encontrados alimentos com esse nome
                <mat-icon> sentiment_very_dissatisfied </mat-icon>
              </p>
            </div>
            }
          </mat-chip-set>
        </div>
      </div>

      <div class="possible-meals-container">
        <div class="meal-container">
          <mat-label class="mat-label-wrap">
            <h2>
              <mat-icon>fastfood</mat-icon>
              Café da Manhã
            </h2>
          </mat-label>
          <div class="selected-foods-container">
            <mat-chip-set
              cdkDropList
              #breakfastFoodSelected="cdkDropList"
              [cdkDropListData]="breakfastSelectedFoods"
              [cdkDropListConnectedTo]="[avaiableFoods]"
              class="selected-food-list mat-mdc-chip-set-stacked"
              (cdkDropListDropped)="dropFood($event)"
            >
              @for (food of breakfastSelectedFoods; track food) {
              @if(food.amount) {
              <mat-chip
                cdkDrag
                (click)="openFoodAmountModal(food, breakfastSelectedFoods)"
              >
                {{ food.name }} -
                <span class="food-amount">{{ food.amount }}gr</span></mat-chip
              >
              } @else {
              <mat-chip
                cdkDrag
                (click)="openFoodAmountModal(food, breakfastSelectedFoods)"
              >
                {{ food.name }}
              </mat-chip>
              } }
            </mat-chip-set>
          </div>
        </div>
        <div class="meal-container">
          <mat-label class="mat-label-wrap">
            <h2>
              <mat-icon>fastfood</mat-icon>
              Lanche
            </h2>
          </mat-label>
          <div class="selected-foods-container">
            <mat-chip-set
              cdkDropList
              #snackFoodSelected="cdkDropList"
              [cdkDropListData]="snackSelectedFoods"
              [cdkDropListConnectedTo]="[avaiableFoods]"
              class="selected-food-list mat-mdc-chip-set-stacked"
              (cdkDropListDropped)="dropFood($event)"
            >
              @for (food of snackSelectedFoods; track food) { @if(food.amount) {
              <mat-chip
                cdkDrag
                (click)="openFoodAmountModal(food, snackSelectedFoods)"
                >{{ food.name }} -
                <span class="food-amount">{{ food.amount }}gr</span></mat-chip
              >
              } @else {
              <mat-chip
                cdkDrag
                (click)="openFoodAmountModal(food, snackSelectedFoods)"
                >{{ food.name }}</mat-chip
              >
              }}
            </mat-chip-set>
          </div>
        </div>

        <div class="meal-container">
          <mat-label class="mat-label-wrap">
            <h2>
              <mat-icon>fastfood</mat-icon>
              Almoço
            </h2>
          </mat-label>
          <div class="selected-foods-container">
            <mat-chip-set
              cdkDropList
              #lunchFoodSelected="cdkDropList"
              [cdkDropListData]="lunchSelectedFoods"
              [cdkDropListConnectedTo]="[avaiableFoods]"
              class="selected-food-list mat-mdc-chip-set-stacked"
              (cdkDropListDropped)="dropFood($event)"
            >
              @for (food of lunchSelectedFoods; track food) { @if(food.amount) {
              <mat-chip
                cdkDrag
                (click)="openFoodAmountModal(food, lunchSelectedFoods)"
                >{{ food.name }} -
                <span class="food-amount">{{ food.amount }}gr</span></mat-chip
              >
              } @else {
              <mat-chip
                cdkDrag
                (click)="openFoodAmountModal(food, lunchSelectedFoods)"
                >{{ food.name }}</mat-chip
              >
              } }
            </mat-chip-set>
          </div>
        </div>

        <div class="meal-container">
          <mat-label class="mat-label-wrap">
            <h2>
              <mat-icon>fastfood</mat-icon>
              Jantar
            </h2>
          </mat-label>
          <div class="selected-foods-container">
            <mat-chip-set
              cdkDropList
              #dinnerFoodSelected="cdkDropList"
              [cdkDropListData]="dinnerSelectedFoods"
              [cdkDropListConnectedTo]="[avaiableFoods]"
              class="selected-food-list mat-mdc-chip-set-stacked"
              (cdkDropListDropped)="dropFood($event)"
            >
              @for (food of dinnerSelectedFoods; track food) { @if(food.amount)
              {
              <mat-chip
                cdkDrag
                (click)="openFoodAmountModal(food, dinnerSelectedFoods)"
                >{{ food.name }} -
                <span class="food-amount">{{ food.amount }}gr</span></mat-chip
              >
              } @else {
              <mat-chip
                cdkDrag
                (click)="openFoodAmountModal(food, dinnerSelectedFoods)"
                >{{ food.name }}</mat-chip
              >
              } }
            </mat-chip-set>
          </div>
        </div>
      </div>
      <div class="button-container">
        <button [disabled]="!dietPlanForm.valid" mat-raised-button class="">
          Criar dieta
        </button>
      </div>
    </form>
  </main>
</div>